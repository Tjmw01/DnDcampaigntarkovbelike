<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DnD Health Tracker — 2 karty (MG/Gracz, online)</title>
  <style>
    :root{--bg:#1b1b1b;--panel:#2a2a2a;--muted:#bdbdbd}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:#f0f0f0;margin:0;padding:20px}
    .topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .role-box{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .container{max-width:1800px;margin:18px auto}
    .tabs{display:flex;gap:8px;margin:12px 0}
    .tab{padding:8px 14px;background:#373737;border-radius:8px;cursor:pointer}
    .tab.active{background:#4a90e2}
    .section{margin-bottom:18px;padding:18px;background:var(--panel);border-radius:12px}
    .flex{display:flex;gap:18px;flex-wrap:wrap}
    .column{flex:1;min-width:260px}
    .character-image{position:relative;max-width:600px}
    .character-image img{width:100%;border-radius:12px;display:block}
    .body-part{position:absolute;padding:6px 8px;border-radius:8px;font-size:13px;color:#111}
    /* Pozycje overlayów dopasowane do Twojej grafiki */
    #head{top:7%;left:31%}
    #torso{top:26%;left:30%}
    #left-arm{top:44%;left:4%}
    #right-arm{top:44%;left:60%}
    #left-leg{top:74%;left:10%}
    #right-leg{top:74%;left:54%}
    input[type="number"]{width:64px}
    .inventory-item{display:block;margin-bottom:8px}
    .mg-panel{background:#232323;padding:12px;border-radius:10px}
    .small{font-size:13px;color:var(--muted)}
    .btn{padding:8px 12px;border-radius:8px;background:#4a90e2;color:#fff;border:none;cursor:pointer}
    .btn.secondary{background:#6b6b6b}
    label.inline{display:flex;align-items:center;gap:8px}
    .hidden{display:none}
    footer{color:var(--muted);font-size:13px;margin-top:18px}
    .badge{padding:4px 8px;border-radius:999px;font-size:12px;background:#333}
    .badge.online{background:#2e7d32}
    .badge.offline{background:#b71c1c}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="role-box">
        <strong>Tryb:</strong>
        <select id="roleSelect">
          <option value="unset">— wybierz —</option>
          <option value="gm">Mistrz Gry</option>
          <option value="player">Gracz</option>
        </select>
        <label class="inline small"><input type="checkbox" id="rememberRole" /> Zapamiętaj wybór</label>
        <span id="connectionStatus" class="badge offline">Offline</span>
      </div>
      <div class="small">
        Kampania: <code>kampania_1</code> (zmienisz w kodzie, jeśli chcesz)
        <br/>
        <button class="btn" id="openRoleSettings">Ustawienia MG</button>
      </div>
    </div>

    <div class="tabs" id="tabs">
      <div class="tab" data-idx="1">Postać 1</div>
      <div class="tab" data-idx="2">Postać 2</div>
    </div>

    <div id="mgPanel" class="section mg-panel hidden">
      <h3>Panel Mistrza Gry</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <label class="inline"><input type="checkbox" id="vis_name" /> Pokaż imię</label>
        <label class="inline"><input type="checkbox" id="vis_hp" /> Pokaż zdrowie</label>
        <label class="inline"><input type="checkbox" id="vis_inventory" /> Pokaż ekwipunek</label>
        <label class="inline"><input type="checkbox" id="allow_player_edit_hp" /> Pozwól graczowi edytować HP</label>
        <label class="inline"><input type="checkbox" id="allow_player_edit_inv" /> Pozwól graczowi edytować ekwipunek</label>
      </div>
      <p class="small" style="margin-top:8px;">
        Ustawienia widoczności i edycji są synchronizowane przez Firebase dla wszystkich graczy.
      </p>
    </div>

    <!-- Panele postaci -->
    <div id="panels">

      <!-- Panel: Postać 1 -->
      <div class="section panel" data-idx="1">
        <div class="flex">
          <div class="column">
            <h2>Imię postaci</h2>
            <input type="text" class="character-name" placeholder="Wpisz imię postaci" />

            <div class="section" style="margin-top:12px">
              <h3>Zdrowie części ciała</h3>
              <div class="character-image">
                <img src="assets/images/Final_hp_photo.jpg" alt="Postać" />

                <div class="body-part" id="head">Głowa:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="torso">Korpus:
                  <input type="number" class="hp-cur" value="20" /> /
                  <input type="number" class="hp-max" value="20" />
                </div>
                <div class="body-part" id="left-arm">L. Ręka:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="right-arm">P. Ręka:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="left-leg">L. Noga:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="right-leg">P. Noga:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
              </div>
            </div>

          </div>

          <div class="column">
            <h3>Ekwipunek</h3>
            <div>
              <label class="inventory-item">Broń: <input type="text" class="inv" placeholder="np. Miecz" /></label>
              <label class="inventory-item">Zbroja: <input type="text" class="inv" placeholder="np. Skórzana Zbroja" /></label>
              <label class="inventory-item">Przedmiot 1: <input type="text" class="inv" /></label>
              <label class="inventory-item">Przedmiot 2: <input type="text" class="inv" /></label>
            </div>

            <div style="margin-top:18px">
              <button class="btn" data-action="export">Eksportuj (JSON)</button>
              <button class="btn secondary" data-action="import">Importuj (wklej JSON)</button>
            </div>

            <div style="margin-top:12px" class="small">
              Stan zapisuje się lokalnie (localStorage) i online (Firebase) dla tej postaci.
            </div>
          </div>
        </div>
      </div>

      <!-- Panel: Postać 2 -->
      <div class="section panel" data-idx="2">
        <div class="flex">
          <div class="column">
            <h2>Imię postaci</h2>
            <input type="text" class="character-name" placeholder="Wpisz imię postaci" />

            <div class="section" style="margin-top:12px">
              <h3>Zdrowie części ciała</h3>
              <div class="character-image">
                <img src="assets/images/Final_hp_photo.jpg" alt="Postać" />

                <div class="body-part" id="head">Głowa:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="torso">Korpus:
                  <input type="number" class="hp-cur" value="20" /> /
                  <input type="number" class="hp-max" value="20" />
                </div>
                <div class="body-part" id="left-arm">L. Ręka:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="right-arm">P. Ręka:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="left-leg">L. Noga:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
                <div class="body-part" id="right-leg">P. Noga:
                  <input type="number" class="hp-cur" value="10" /> /
                  <input type="number" class="hp-max" value="10" />
                </div>
              </div>
            </div>

          </div>

          <div class="column">
            <h3>Ekwipunek</h3>
            <div>
              <label class="inventory-item">Broń: <input type="text" class="inv" placeholder="np. Miecz" /></label>
              <label class="inventory-item">Zbroja: <input type="text" class="inv" placeholder="np. Skórzana Zbroja" /></label>
              <label class="inventory-item">Przedmiot 1: <input type="text" class="inv" /></label>
              <label class="inventory-item">Przedmiot 2: <input type="text" class="inv" /></label>
            </div>
